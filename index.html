<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags always come first -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<!-- build:css css/main.css -->
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />

	<!-- Additional CSS must be placed after bootstrap.css -->
	<script src="https://kit.fontawesome.com/50affd80b8.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="css/localstyles.css" />
	<!-- endbuild -->
	<title>Nextcloud :: Grocery</title>
</head>

<body>
	<header class='jumbotron jumbotron-fluid sticky-top nextcloud-header'>
		<div class="container-flush">
			<div class="row">
				<div class="col-10">
					<h4 id="list-title">List Title</h4>
				</div>
				<div class="col-2">
					<button class="btn text-light fa-lg fa-regular fa-circle-question" name="btnHelp" id="btnHelp" />
					<button class="btn text-light fa-lg fa-solid fa-gear" name="btnSettings" id="btnSettings" />
				</div>
			</div>
		</div>
	</header>

	<div id='list-root' class='accordion accordion-flush'>
	</div>

	<div id="json-display"></div>
	<footer class='sticky-footer'>
		<div class='container-fluid'>
			<div class='row'>
				<div class='col'>
					<input type="text" name="text" id="inputField">
					<button class="btn btn-primary fa-solid fa-broom" name="btnX" id="btnX" />
					<button class="btn btn-success fa-solid fa-bookmark" name="btnY" id="btnY" data-state='list' />
				</div>
			</div>
		</div>

	</footer>

	<!-- build:js js/main.js -->
	<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>
	<script src="js/ListItem.js"></script>
	<script src="js/ShoppingList.js"></script>
	<script src="js/funs/globalFuns.js"></script>
	<!-- endbuild -->

	<script>
		const debug = false;
		const jsonDisp = document.getElementById('json-display');

		const _State = new Map();
		_State.set('mode', 'list');;
		_State.set('root', document.getElementById('list-root'));
		_State.set('title', document.getElementById('list-title'));
		_State.set('inputField', document.getElementById('inputField'));
		_State.set('btnX', document.getElementById('btnX'));
		_State.set('btnY', document.getElementById('btnY'));
		_State.set('funs', {
					inputFieldBlur: addItemByStr,
					inputFieldCheck: validateItemInput,
					btnX: sweepList,
					btnY: toggleView
				} );
		_State.set('_Lists', new Map()); // not doing anything with this yet but we'll need it later
		_State.set('list', new ShoppingList( { listName: 'placeholder' } ));

		let jsonData;

		const _TestList = _State.get('list');
		fetch('res/testList-Listjs.json')
			.then(resp => resp.json())
			.then(Data => {
				_TestList.listName = Data.listName;
				_TestList.listID = Data.listID;
				_TestList.creationDate = Data.creationDate;
				_TestList.modifyDate = Data.modifyDate;
				//debug ? debugMsg('fetch Data', [ Data ]) : null;
				Data.items.forEach((item) => { _TestList.addItem(new ListItem(item), _TestList); });
			})
			.then(() => {
				//debug ? debugMsg('fetch complete', [ _TestList ]) : null;
				document.getElementById('list-title').textContent = `${_TestList.listName}: List`;
				_TestList.items.forEach((item) => item.listParent = _TestList);
				_TestList.getListView(_TestList, _State.get('root'));
			});

		_State.get('_Lists').set(`${_TestList.listID}`, _TestList);
		inputField.addEventListener('blur', () => { _State.get('funs').inputFieldBlur(inputField.value, _State) });
		inputField.addEventListener('beforeinput', (e) => { _State.get('funs').inputFieldCheck(e, _State) });
		btnX.addEventListener('click', () => { _State.get('funs').btnX(_State) });
		btnY.addEventListener('click', () => { _State.get('funs').btnY(_State) });
	</script>

</body>

</html>


